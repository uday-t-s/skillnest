{% extends 'skillnest_app/base.html' %}
{% load static %}

{% block title %}Jobs - SkillNest{% endblock %}

{% block content %}
<section class="jobs-section">
   <div class="jobs-hero">
      <h1 class="heading">Job Placements</h1>
      <p class="subtitle">Browse opportunities from top companies and apply today.</p>
      
      <!-- Search Bar -->
      <form method="GET" class="job-search-form">
         <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input 
               type="text" 
               name="search" 
               placeholder="Search by job title, company, or location..." 
               value="{{ search_query }}"
               class="search-input"
            >
            <button type="submit" class="search-btn">Search</button>
         </div>
      </form>
   </div>

   <!-- Jobs Grid -->
   <div class="jobs-container">
      {% for job in jobs %}
         <div class="job-card">
            <!-- Company Header -->
            <div class="job-card-header">
               <div class="company-info">
                  <h3 class="company-name">{{ job.company_name }}</h3>
                  <span class="posted-date">
                     <i class="fas fa-calendar-alt"></i> {{ job.posted_date|date:"M d, Y" }}
                  </span>
               </div>
               <span class="job-type-badge job-type-{{ job.job_type|lower }}">
                  {{ job.get_job_type_display }}
               </span>
            </div>

            <!-- Job Title -->
            <h2 class="job-title">{{ job.job_title }}</h2>

            <!-- Job Description -->
            <p class="job-description">{{ job.description|truncatewords:30 }}</p>

            <!-- Job Info Row -->
            <div class="job-info-row">
               <div class="info-item location">
                  <i class="fas fa-map-marker-alt"></i>
                  <span>{{ job.location }}</span>
               </div>
               
               {% if job.salary_min and job.salary_max %}
                  <div class="info-item salary">
                     <i class="fas fa-dollar-sign"></i>
                     <span>₹{{ job.salary_min|floatformat:0 }} - ₹{{ job.salary_max|floatformat:0 }}</span>
                  </div>
               {% endif %}
            </div>

            <!-- Required Skills -->
            {% if job.skills_required.all %}
               <div class="skills-section">
                  <p class="skills-label"><i class="fas fa-star"></i> Required Skills:</p>
                  <div class="skills-list">
                     {% for skill in job.skills_required.all|slice:":5" %}
                        <span class="skill-tag">{{ skill.skill_name }}</span>
                     {% endfor %}
                     {% if job.skills_required.count > 5 %}
                        <span class="skill-tag more">+{{ job.skills_required.count|add:"-5" }}</span>
                     {% endif %}
                  </div>
               </div>
            {% endif %}

            <!-- Match Score (for authenticated users) -->
            {% if user.is_authenticated and job.match_percent %}
               <div class="match-section">
                  <div class="match-label">
                     <strong>Your Match Score:</strong>
                  </div>
                  <div class="match-bar-container">
                     <div class="match-bar">
                        <div class="match-fill" style="width: {{ job.match_percent }}%"></div>
                     </div>
                     <span class="match-percent">{{ job.match_percent|floatformat:0 }}%</span>
                  </div>
                  
                  <!-- Match Feedback -->
                  {% if job.match_percent >= 75 %}
                     <span class="match-badge excellent">
                        <i class="fas fa-check-circle"></i> Excellent Match!
                     </span>
                  {% elif job.match_percent >= 50 %}
                     <span class="match-badge good">
                        <i class="fas fa-check-circle"></i> Good Match
                     </span>
                  {% elif job.match_percent > 0 %}
                     <span class="match-badge partial">
                        <i class="fas fa-exclamation-circle"></i> Partial Match
                     </span>
                  {% else %}
                     <span class="match-badge none">
                        <i class="fas fa-times-circle"></i> No Match Yet
                     </span>
                  {% endif %}
               </div>
            {% endif %}

            <!-- Action Button -->
            <a href="{% url 'job_detail' job.id %}" class="job-btn">
               <span>View Full Details & Apply</span>
               <i class="fas fa-arrow-right"></i>
            </a>
         </div>
      {% empty %}
         <div class="empty-state">
            <i class="fas fa-briefcase"></i>
            <h3>No Jobs Available</h3>
            <p>No job openings match your search. Try adjusting your filters or check back soon!</p>
         </div>
      {% endfor %}
   </div>
</section>

<style>
   .jobs-section {
      padding: 2rem 0;
      background: #f8fafc;
      min-height: 100vh;
   }

   .jobs-hero {
      text-align: center;
      margin-bottom: 3rem;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      margin: 2rem auto;
      max-width: 1200px;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
   }

   .jobs-hero .heading {
      font-size: 3rem;
      margin-bottom: 0.5rem;
      color: white;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
   }

   .jobs-hero .subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 2rem;
      letter-spacing: 0.5px;
   }

   .job-search-form {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
   }

   .search-wrapper {
      display: flex;
      align-items: center;
      background: white;
      border-radius: 8px;
      padding: 0.8rem 1.2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
   }

   .search-wrapper:focus-within {
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
   }

   .search-wrapper i {
      color: #667eea;
      margin-right: 0.8rem;
      font-size: 1.1rem;
   }

   .search-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 1rem;
      color: #2d3748;
      background: transparent;
      padding: 0.4rem 0;
   }

   .search-input::placeholder {
      color: #cbd5e0;
   }

   .search-btn {
      padding: 0.6rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 0.8rem;
      font-size: 0.9rem;
      white-space: nowrap;
   }

   .search-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
   }

   .jobs-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 2rem;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
   }

   .job-card {
      background: white;
      border-radius: 12px;
      padding: 1.8rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
   }

   .job-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
   }

   .job-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.25);
      border-color: #cbd5e1;
   }

   .job-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      gap: 1rem;
   }

   .company-info {
      flex: 1;
   }

   .company-name {
      font-size: 1rem;
      color: #667eea;
      font-weight: 700;
      margin: 0 0 0.4rem 0;
      letter-spacing: 0.5px;
      text-transform: uppercase;
   }

   .posted-date {
      font-size: 0.85rem;
      color: #718096;
      display: flex;
      align-items: center;
      gap: 0.4rem;
   }

   .job-type-badge {
      padding: 0.4rem 1rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
   }

   .job-type-full_time {
      background: #dcfce7;
      color: #166534;
   }

   .job-type-part_time {
      background: #fef3c7;
      color: #92400e;
   }

   .job-type-contract {
      background: #f3e8ff;
      color: #6b21a8;
   }

   .job-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2d3748;
      margin: 0 0 1rem 0;
      line-height: 1.3;
   }

   .job-meta {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.2rem;
   }

   .meta-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #4a5568;
      font-size: 0.95rem;
   }

   .meta-item i {
      color: #667eea;
      font-size: 1rem;
   }

   .meta-item.salary {
      background: #f0f4ff;
      color: #667eea;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-weight: 600;
   }

   .skills-section {
      margin-bottom: 1rem;
   }

   .skills-label {
      font-size: 0.85rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
   }

   .skills-label i {
      color: #f59e0b;
   }

   .skills-list {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
   }

   .skill-tag {
      background: #f0f4ff;
      color: #667eea;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      border: 1px solid #cbd5e0;
      transition: all 0.3s ease;
   }

   .skill-tag:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
   }

   .skill-tag.more {
      background: transparent;
      color: #718096;
      cursor: default;
      border: none;
   }

   .match-score-display {
      padding: 1rem;
      background: #f8fafc;
      border-radius: 8px;
      margin-bottom: 1rem;
      border: 1px solid #e2e8f0;
   }

   .match-section {
      padding: 1rem;
      background: linear-gradient(135deg, #fff7ed 0%, #fef3c7 100%);
      border-radius: 8px;
      margin-bottom: 1rem;
      border-left: 3px solid #f59e0b;
   }

   .match-label {
      font-size: 0.85rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
   }

   .match-bar-container {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-bottom: 0.8rem;
   }

   .match-bar {
      flex: 1;
      height: 6px;
      background: #e2e8f0;
      border-radius: 3px;
      overflow: hidden;
   }

   .match-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      border-radius: 3px;
      transition: width 0.3s ease;
   }

   .match-percent {
      font-weight: 700;
      color: #10b981;
      font-size: 0.9rem;
      min-width: 45px;
      text-align: right;
   }

   .match-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.9rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 700;
   }

   .match-badge.excellent {
      background: #dcfce7;
      color: #166534;
   }

   .match-badge.good {
      background: #dbeafe;
      color: #1e40af;
   }

   .match-badge.partial {
      background: #fef3c7;
      color: #92400e;
   }

   .match-badge.none {
      background: #fee2e2;
      color: #991b1b;
   }

   .job-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      padding: 0.9rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
   }

   .job-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);
   }

   .job-btn i {
      font-size: 0.9rem;
      transition: transform 0.3s ease;
   }

   .job-btn:hover i {
      transform: translateX(3px);
   }

   .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4rem 2rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
   }

   .job-description {
      color: #4a5568;
      font-size: 0.95rem;
      line-height: 1.6;
      margin: 0 0 1.2rem 0;
      flex-grow: 1;
   }

   .job-info-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.2rem;
   }

   .info-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #4a5568;
      font-size: 0.95rem;
   }

   .info-item i {
      color: #667eea;
      font-size: 1rem;
   }

   .info-item.salary {
      background: #f0f4ff;
      color: #667eea;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-weight: 600;
   }

   .empty-state i {
      font-size: 3.5rem;
      color: #cbd5e0;
      margin-bottom: 1rem;
      display: block;
   }

   .empty-state h3 {
      font-size: 1.5rem;
      color: #2d3748;
      margin: 0 0 0.5rem 0;
   }

   .empty-state p {
      color: #718096;
      margin: 0;
   }

   /* Responsive */
   @media (max-width: 768px) {
      .jobs-hero {
         padding: 2rem 1rem;
         margin: 1rem;
      }

      .jobs-hero .heading {
         font-size: 2rem;
      }

      .search-wrapper {
         flex-direction: column;
         gap: 0.8rem;
      }

      .search-wrapper i {
         margin: 0;
      }

      .search-input {
         width: 100%;
      }

      .search-btn {
         width: 100%;
         margin-left: 0;
      }

      .jobs-container {
         grid-template-columns: 1fr;
         padding: 0 1rem;
         gap: 1.5rem;
      }

      .job-card-header {
         flex-direction: column;
         gap: 0.8rem;
      }

      .job-title {
         font-size: 1.25rem;
      }

      .job-meta {
         flex-direction: column;
         gap: 0.5rem;
      }
   }

   @media (max-width: 480px) {
      .jobs-hero .heading {
         font-size: 1.5rem;
      }

      .jobs-hero .subtitle {
         font-size: 0.95rem;
      }

      .job-title {
         font-size: 1.1rem;
      }

      .search-input::placeholder {
         font-size: 0.9rem;
      }
   }
</style>
{% endblock %}
