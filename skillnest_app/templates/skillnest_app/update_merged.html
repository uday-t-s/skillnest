{% extends 'skillnest_app/base.html' %}
{% load static %}

{% block title %}Update Profile - SkillNest{% endblock %}

{% block content %}
<section class="update-section">
   <div class="update-container">
      <h1 class="heading">Update Your Information</h1>

      {% if messages %}
         {% for message in messages %}
            {% if message.tags == 'success' %}
               <div class="alert" style="background: #d1fae5; color: #065f46; padding: 0.8rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                  {{ message }}
               </div>
            {% else %}
               <div class="alert" style="background: #fee2e2; color: #7f1d1d; padding: 0.8rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                  {{ message }}
               </div>
            {% endif %}
         {% endfor %}
      {% endif %}

      <form method="post" enctype="multipart/form-data" class="update-form">
         {% csrf_token %}

         <div class="form-section">
            <h2>Personal Information</h2>
            
            <div class="form-group">
               <label for="id_first_name">First Name</label>
               {{ form.first_name }}
               {% if form.first_name.errors %}<span class="error">{{ form.first_name.errors }}</span>{% endif %}
            </div>

            <div class="form-group">
               <label for="id_last_name">Last Name</label>
               {{ form.last_name }}
               {% if form.last_name.errors %}<span class="error">{{ form.last_name.errors }}</span>{% endif %}
            </div>

            <div class="form-group">
               <label for="id_email">Email Address</label>
               {{ form.email }}
               {% if form.email.errors %}<span class="error">{{ form.email.errors }}</span>{% endif %}
            </div>
         </div>

         <div class="form-section">
            <h2>Profile Information</h2>

            <div class="form-group">
               <label for="id_profile_picture">Profile Picture</label>
               {{ form.profile_picture }}
               {% if form.profile_picture.errors %}<span class="error">{{ form.profile_picture.errors }}</span>{% endif %}
               {% if user.profile.profile_picture %}
                  <p class="small-text" style="margin-top: 0.5rem;">
                     <img src="{{ user.profile.profile_picture.url }}" alt="Current picture" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
                  </p>
               {% endif %}
            </div>

            <div class="form-group">
               <label for="id_bio">Bio / About</label>
               {{ form.bio }}
               {% if form.bio.errors %}<span class="error">{{ form.bio.errors }}</span>{% endif %}
               <small style="display: block; color: #64748b; margin-top: 0.3rem;">Tell us about yourself (max 500 characters)</small>
            </div>

            {% if user.profile.role == 'teacher' %}
               <div class="form-group">
                  <label for="id_specialization">Specialization</label>
                  {{ form.specialization }}
                  {% if form.specialization.errors %}<span class="error">{{ form.specialization.errors }}</span>{% endif %}
               </div>
            {% endif %}

            <div class="form-group">
               <label for="id_role">Account Type</label>
               <p class="small-text">Current role: <strong>{{ user.profile.role|title }}</strong></p>
               <small style="display: block; color: #94a3b8;">Contact support to change your account type</small>
            </div>
         </div>

         <div class="form-section">
            <h2>Security</h2>
            
            <div class="form-group">
               <label for="id_password">Change Password (Optional)</label>
               {{ form.password }}
               {% if form.password.errors %}<span class="error">{{ form.password.errors }}</span>{% endif %}
               <small style="display: block; color: #64748b; margin-top: 0.3rem;">Leave blank to keep your current password</small>
            </div>
         </div>

         <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn">Save Changes</button>
            <a href="{% url 'profile' %}" class="option-btn" style="text-align: center;">Cancel</a>
         </div>
      </form>
   </div>
</section>

<style>
   .update-section {
      max-width: 700px;
      margin: 2rem auto;
      padding: 0 1.5rem;
   }

   .update-container {
      background: white;
      padding: 2rem;
      border-radius: 0.75rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
   }

   .form-section {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid #e5e7eb;
   }

   .form-section:last-child {
      border-bottom: none;
   }

   .form-section h2 {
      font-size: 1.3rem;
      color: #0f172a;
      margin-bottom: 1rem;
   }

   .form-group {
      margin-bottom: 1.2rem;
   }

   .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #334155;
   }

   .form-group input[type="text"],
   .form-group input[type="email"],
   .form-group input[type="password"],
   .form-group select,
   .form-group textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #cbd5e1;
      border-radius: 0.5rem;
      background: #f8fafc;
      font-size: 1rem;
      transition: all 0.15s;
      font-family: inherit;
      box-sizing: border-box;
   }

   .form-group input:focus,
   .form-group select:focus,
   .form-group textarea:focus {
      outline: none;
      border-color: #2563eb;
      background: white;
      box-shadow: 0 0 0 2px #bfdbfe;
   }

   .btn {
      background: #2563eb;
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background 0.2s;
   }

   .btn:hover {
      background: #1d4ed8;
   }

   .option-btn {
      background: white;
      color: #334155;
      padding: 0.8rem 1.5rem;
      border: 1px solid #cbd5e1;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.2s;
      text-decoration: none;
   }

   .option-btn:hover {
      background: #f8fafc;
      border-color: #94a3b8;
   }

   .error {
      color: #dc2626;
      font-size: 0.85rem;
      display: block;
      margin-top: 0.3rem;
   }
</style>
{% endblock %}
